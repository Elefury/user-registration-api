{
  "info": {
    "name": "User Registration API",
    "description": "API для регистрации и управления пользователями",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000/api",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Регистрация нового пользователя",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"name\": \"Иван Иванов\",\n    \"email\": \"ivan@example.com\",\n    \"password\": \"password123\",\n    \"gender\": \"male\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/registration",
          "host": ["{{base_url}}"],
          "path": ["registration"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Есть токен\", function () { \n    var jsonData = pm.response.json();\n    pm.expect(jsonData.access_token).to.be.a('string');\n    if (jsonData.access_token) {\n        pm.collectionVariables.set(\"access_token\", jsonData.access_token);\n    }\n});"
            ]
          }
        }
      ]
    },
    {
      "name": "2. Логин пользователя",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"ivan@example.com\",\n    \"password\": \"password123\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/login",
          "host": ["{{base_url}}"],
          "path": ["login"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Есть токен\", function () { \n    var jsonData = pm.response.json();\n    pm.expect(jsonData.access_token).to.be.a('string');\n    if (jsonData.access_token) {\n        pm.collectionVariables.set(\"access_token\", jsonData.access_token);\n    }\n});"
            ]
          }
        }
      ]
    },
    {
      "name": "3. Получить профиль (с токеном)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{access_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/profile",
          "host": ["{{base_url}}"],
          "path": ["profile"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Есть данные пользователя\", function () { \n    var jsonData = pm.response.json();\n    pm.expect(jsonData.user).to.be.an('object');\n    pm.expect(jsonData.user.email).to.eql('ivan@example.com');\n});"
            ]
          }
        }
      ]
    },
    {
      "name": "4. Получить профиль (без токена)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/profile",
          "host": ["{{base_url}}"],
          "path": ["profile"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 401\", function () { pm.response.to.have.status(401); });"
            ]
          }
        }
      ]
    },
    {
      "name": "5. Регистрация с ошибками валидации",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"неправильный-email\",\n    \"password\": \"123\",\n    \"gender\": \"неправильный_пол\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/registration",
          "host": ["{{base_url}}"],
          "path": ["registration"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 422\", function () { pm.response.to.have.status(422); });",
              "pm.test(\"Есть ошибки валидации\", function () { \n    var jsonData = pm.response.json();\n    pm.expect(jsonData.errors).to.be.an('object');\n});"
            ]
          }
        }
      ]
    },
    {
      "name": "6. Регистрация с существующим email",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"name\": \"Петр Петров\",\n    \"email\": \"ivan@example.com\",\n    \"password\": \"password456\",\n    \"gender\": \"male\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/registration",
          "host": ["{{base_url}}"],
          "path": ["registration"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 422\", function () { pm.response.to.have.status(422); });",
              "pm.test(\"Ошибка уникальности email\", function () { \n    var jsonData = pm.response.json();\n    pm.expect(jsonData.errors.email[0]).to.include('already been taken');\n});"
            ]
          }
        }
      ]
    },
    {
      "name": "7. Регистрация пользователя без имени",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"email\": \"anna@example.com\",\n    \"password\": \"anna123456\",\n    \"gender\": \"female\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/registration",
          "host": ["{{base_url}}"],
          "path": ["registration"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Пользователь создан без имени\", function () { \n    var jsonData = pm.response.json();\n    pm.expect(jsonData.user.name).to.be.null;\n});"
            ]
          }
        }
      ]
    },
    {
      "name": "8. Регистрация пользователя с полом 'other'",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"name\": \"Алексей\",\n    \"email\": \"alex@example.com\",\n    \"password\": \"alex123456\",\n    \"gender\": \"other\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/registration",
          "host": ["{{base_url}}"],
          "path": ["registration"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Статус 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Пользователь создан с полом other\", function () { \n    var jsonData = pm.response.json();\n    pm.expect(jsonData.user.gender).to.eql('other');\n});"
            ]
          }
        }
      ]
    }
  ]
}